
DECLARE @Fecha1 DATE = '2024-06-01';
DECLARE @Fecha2 DATE = '20240601';


SELECT 
    M.ccargo_car COD,39 CIA,fecha,M.nfolio RESERV, 1 TIP,A.ident_cli TERCERO,'001' SUC,'' NAC,
	CONVERT(int,(CASE WHEN dbcr = 'D' THEN 1 ELSE -1 END * valor )) VALOR,CASE WHEN ISNUMERIC(M.nrohab_hab) = 1 THEN CONVERT(varchar(10), M.nrohab_hab) 
        ELSE '9999' END HAB,
    CASE  WHEN ISNUMERIC(recibocaj) = 1 THEN CONVERT(VARCHAR(10), recibocaj)
    ELSE NULL END RECIBO,nroregis TRX_NO,factura FACTURA,descri_car REFERENCIA,motivo NOTAS,M.tcre NRO_TARJETA,M.autor AUTORIZACION,M.vcto FECHA_DE_VENC,
    '' FACT_ASOC,'' TIPO_DOC,tasachin_us VALOR_ME,(SELECT Max(nombre_cli) FROM clientes C WHERE  C.ident_cli = A.ident_cli) DISPLAY_NAME,
    '' NOMBRE,
	(SELECT Max(direcc_cli) FROM Clientes C WHERE  C.ident_cli = A.ident_cli) address1,
    (SELECT Max(codciud) FROM Clientes C WHERE  C.ident_cli = A.ident_cli) city,
    (SELECT Max(codpais) FROM Clientes C WHERE  C.ident_cli = A.ident_cli) country,
    (SELECT Max(telef_cli) FROM Clientes C WHERE  C.ident_cli = A.ident_cli) phone_no
FROM 
    Movfolio M,Cargos C,Maefolio A
WHERE  M.ccargo_car = C.ccargo_car AND M.nfolio = A.nfolio AND fecha = @Fecha1 AND ( M.ccargo_car <> 1000 AND M.ccargo_car NOT IN ( 8,1100, 54, 1010,5016 ) )
    AND ( m.plaza = '0' OR m.plaza IS NULL )

	UNION

	SELECT 8 COD,39 CIA,U.FECHA,U.cuenta RESERV,1 TIP,'333333333' TERCERO,
    '001' SUC,'' NAC,CONVERT(int,U.SERVICIO) VALOR,9999 HAB,U.CODIGO_EVE RECIBO,U.CUENTA TRX_NO,
    U.FACTURA FACTURA,U.MOTIVO REFERENCIA,U.MOTIVO NOTAS,'' NRO_TARJETA,'' AUTORIZACION,U.FECHA FECHA_DE_VENC,'' FACT_ASOC,
    '' TIPO_DOC,U.SERVICIO/2 VALOR_ME,'' DISPLAY_NAME,U.TITULAR NOMBRE,
    (SELECT Max(direcc_cli) FROM Clientes C WHERE  C.ident_cli = U.CEDULA) address1,
    (SELECT Max(codciud) FROM Clientes C WHERE  C.ident_cli = U.CEDULA) city,
    (SELECT Max(codpais) FROM Clientes C WHERE  C.ident_cli = U.CEDULA) country,
    U.TELEFONO phone_no FROM   Ps_Cuentas U 
WHERE U.fecha = @Fecha2 AND U.SERVICIO <> 0


	UNION

 select  M.CCARGO_CAR COD , 39 CIA,M.FECHA,  M.nfolio RESERV, 1 TIP, M.IDENT_CLI TERCERO, '001' SUC,
'' NAC, CONVERT(int,( CASE WHEN dbcr = 'D' THEN 1 ELSE -1 END * valor )) VALOR,'9999' HAB,CONVERT(VARCHAR(10), recibocaj) RECIBO, 
nroregis TRX_NO, 12344 FACTURA, M.MOTIVO REFERENCIA, M.MOTIVO NOTAS,M.tcre NRO_TARJETA, M.autor AUTORIZACION,
M.vcto FECHA_DE_VENC,'' FACT_ASOC,'' TIPO_DOC,  ( CASE WHEN dbcr = 'D' THEN 1 ELSE -1 END * valor ) VALORME,

(SELECT Max(nombre_cli) FROM Clientes C WHERE  C.IDENT_CLI = M.IDENT_CLI) DISPLAY_NAME, '' NOMBRE,
 (SELECT Max(direcc_cli) FROM Clientes C WHERE  C.ident_cli = M.ident_cli) address1,
 (SELECT Max(codciud)FROM Clientes C WHERE  C.ident_cli = M.ident_cli) city,
 (SELECT Max(codpais)FROM Clientes C WHERE  C.ident_cli = M.ident_cli) country,
 (SELECT Max(telef_cli)FROM Clientes C WHERE  C.ident_cli = M.ident_cli) phone_no
 
 from Movfolio  M WHERE M.fecha=@Fecha1 and M.CCARGO_CAR= 1100

 
	UNION

SELECT  
    CASE 
        WHEN A.TIPOPROD = 'A' THEN 
            CASE 
                WHEN C.CODCAJA = 'RESTP' THEN 5006 
                ELSE CASE WHEN C.CODCAJA = 'BFP' THEN 5009
                ELSE CASE WHEN C.CODCAJA = 'RS' THEN 5010 
                ELSE CASE WHEN C.CODCAJA = 'REST' THEN 5006 
                ELSE CASE WHEN C.CODCAJA = 'MRKT' THEN 5008 
                ELSE CASE WHEN C.CODCAJA = 'EVEN' THEN 5011 
                ELSE 4300 END END END END END END 
        ELSE 
            CASE 
                WHEN A.TIPOPROD = 'B' THEN 
                    CASE 
                        WHEN C.CODCAJA = 'RESTP' THEN 5007
                        ELSE CASE WHEN C.CODCAJA = 'BFP' THEN 5009
                        ELSE CASE WHEN C.CODCAJA = 'RS' THEN 5010 
                        ELSE CASE WHEN C.CODCAJA = 'REST' THEN 5007 
                        ELSE CASE WHEN C.CODCAJA = 'MRKT' THEN 5008 
                        ELSE CASE WHEN C.CODCAJA = 'EVEN' THEN 5011 
                        END END END END END END 
            END 
    END COD,
    39 CIA,C.FECHA,C.CUENTA RESERV,1 TIP,'333333333' TERCERO,'001' SUC,'' NAC,CONVERT(int,C.VVENTA) VALOR,9999 HAB,
    C.TIQUETE RECIBO,C.CONSUID TRX_NO,C.tiquete FACTURA,P.descripcion REFERENCIA,A.TIPOPROD NOTAS,'' NRO_TARJETA,'' AUTORIZACION,
    NULL FECHA_DE_VENC,'' FACT_ASOC,'POS' TIPO_DOC,C.VVENTA VALOR_ME,'' DISPLAY_NAME,'' NOMBRE,'' address1,'' city,'' country,'' phone_no
FROM 
    ps_consumos C
INNER JOIN 
    ps_cuentas Q ON c.FECHA = Q.FECHA AND C.CODCAJA = Q.CODCAJA AND C.CUENTA = Q.CUENTA
INNER JOIN 
    Ps_producto P ON C.CODPRODUCTO = P.CODPRODUCTO
INNER JOIN 
    Ps_Agrupa A ON A.CODAGRUPA = P.CODAGRUPA
WHERE 
    C.fecha = '20240601'  
    AND C.TRANSFERID IS NULL  
    AND C.PLAZA <>'ATN'  
    AND C.VVENTA >0

UNION 

SELECT 5016 COD,39 CIA,fecha,C.cuenta RESERV,1 TIP,'333333333' TERCERO,'001' SUC,'' NAC,CONVERT(int,C.propinapagada)    VALOR,
9999 HAB,CONVERT(VARCHAR(10), tiquete)  RECIBO,consuid TRX_NO,tiquete FACTURA,'PROPINA POS' REFERENCIA, C.codcentro + '-' + ' PROPINA' NOTAS,
'' NRO_TARJETA,'' AUTORIZACION,NULL FECHA_DE_VENC,'' FACT_ASOC,'POS' TIPO_DOC,0 VALOR_ME,'' DISPLAY_NAME,'' NOMBRE,'' address1,
'' city,''      country,'' phone_no
FROM   ps_consumos C WHERE  fecha = @Fecha2 AND PLAZA =' ' AND propinapagada <> 0 and TRANSFERIDO is null 
      
union 

--VISA FRONT
select  9106 COD , 39 CIA,M.FECHA,  M.nfolio RESERV, 1 TIP, M.IDENT_CLI TERCERO, '001' SUC,
'' NAC, CONVERT(INT,valor)  VALOR,'9999' HAB,CONVERT(VARCHAR(10), recibocaj) RECIBO, 
nroregis TRX_NO, 12344 FACTURA, M.MOTIVO REFERENCIA, M.MOTIVO NOTAS,M.tcre NRO_TARJETA, M.autor AUTORIZACION,
M.vcto FECHA_DE_VENC,'' FACT_ASOC,'' TIPO_DOC,  ( CASE WHEN dbcr = 'D' THEN 1 ELSE -1 END * valor ) VALORME,
(SELECT Max(nombre_cli) FROM Clientes C WHERE  C.IDENT_CLI = M.IDENT_CLI) DISPLAY_NAME, '' NOMBRE,
 (SELECT Max(direcc_cli) FROM Clientes C WHERE  C.ident_cli = M.ident_cli) address1,
 (SELECT Max(codciud)FROM Clientes C WHERE  C.ident_cli = M.ident_cli) city,
 (SELECT Max(codpais)FROM Clientes C WHERE  C.ident_cli = M.ident_cli) country,
 (SELECT Max(telef_cli)FROM Clientes C WHERE  C.ident_cli = M.ident_cli) phone_no 
 FROM movfolio M WHERE fecha =@Fecha1 AND ccargo_car = 1000 AND dbcr = 'D'
UNION
--DEBITO VISA POS
SELECT '9106'  COD,39 CIA,C.FECHA,C.CUENTA RESERV,1 TIP,'333333333' TERCERO,'001' SUC,'' NAC,CONVERT(int,C.VVENTA*-1) VALOR,9999 HAB,C.TIQUETE RECIBO,
C.CONSUID TRX_NO,C.tiquete FACTURA,P.descripcion REFERENCIA,A.TIPOPROD NOTAS,'' NRO_TARJETA,'' AUTORIZACION,NULL FECHA_DE_VENC,'' FACT_ASOC,'POS' TIPO_DOC,
C.VVENTA VALOR_ME,'' DISPLAY_NAME,'' NOMBRE,'' address1,'' city,'' country,'' phone_no
FROM ps_consumos C
LEFT JOIN ps_cuentas Q ON c.FECHA = Q.FECHA AND C.CODCAJA = Q.CODCAJA AND C.CUENTA = Q.CUENTA
LEFT JOIN Ps_producto P ON C.CODPRODUCTO = P.CODPRODUCTO
LEFT JOIN  Ps_Agrupa A ON A.CODAGRUPA = P.CODAGRUPA
WHERE C.fecha = @Fecha2 AND CODFPGO = 'TDV'
UNION
--EFECTIVO POS
SELECT '9100'  COD,39 CIA,C.FECHA,C.CUENTA RESERV,1 TIP,'333333333' TERCERO,'001' SUC,'' NAC,CONVERT(int,C.VVENTA*-1) VALOR,9999 HAB,C.TIQUETE RECIBO,
C.CONSUID TRX_NO,C.tiquete FACTURA,P.descripcion REFERENCIA,A.TIPOPROD NOTAS,'' NRO_TARJETA,'' AUTORIZACION,NULL FECHA_DE_VENC,'' FACT_ASOC,
'POS' TIPO_DOC,C.VVENTA VALOR_ME,'' DISPLAY_NAME,'' NOMBRE,'' address1,'' city,'' country,'' phone_no
FROM ps_consumos C
LEFT JOIN ps_cuentas Q ON c.FECHA = Q.FECHA AND C.CODCAJA = Q.CODCAJA AND C.CUENTA = Q.CUENTA
LEFT JOIN Ps_producto P ON C.CODPRODUCTO = P.CODPRODUCTO
LEFT JOIN  Ps_Agrupa A ON A.CODAGRUPA = P.CODAGRUPA
WHERE C.fecha = @Fecha2 AND TRANSFERID <> 'B' AND CODFPGO = 'EFE'
UNION
--CREDITO MASTERCARD POS
SELECT '9109'  COD,39 CIA,C.FECHA,C.CUENTA RESERV,1 TIP,'333333333' TERCERO,'001' SUC,'' NAC,CONVERT(int,C.VVENTA*-1) VALOR,9999 HAB,C.TIQUETE RECIBO,
C.CONSUID TRX_NO,C.tiquete FACTURA,P.descripcion REFERENCIA,A.TIPOPROD NOTAS,'' NRO_TARJETA,'' AUTORIZACION,NULL FECHA_DE_VENC,
'' FACT_ASOC,'POS' TIPO_DOC,C.VVENTA VALOR_ME,'' DISPLAY_NAME,'' NOMBRE,'' address1,'' city,'' country,'' phone_no
FROM ps_consumos C
LEFT JOIN ps_cuentas Q ON c.FECHA = Q.FECHA AND C.CODCAJA = Q.CODCAJA AND C.CUENTA = Q.CUENTA
LEFT JOIN Ps_producto P ON C.CODPRODUCTO = P.CODPRODUCTO
LEFT JOIN  Ps_Agrupa A ON A.CODAGRUPA = P.CODAGRUPA
WHERE C.fecha = @Fecha2 AND TRANSFERID <> 'B' AND CODFPGO = 'TCM'
UNION
--DEBITO MASTERCARD POS
SELECT '9109'  COD,39 CIA,C.FECHA,C.CUENTA RESERV,1 TIP,'333333333' TERCERO,'001' SUC,'' NAC,CONVERT(int,C.VVENTA*-1) VALOR,9999 HAB,C.TIQUETE RECIBO,
C.CONSUID TRX_NO,C.tiquete FACTURA,P.descripcion REFERENCIA,A.TIPOPROD NOTAS,'' NRO_TARJETA,'' AUTORIZACION,NULL FECHA_DE_VENC,
'' FACT_ASOC,'POS' TIPO_DOC,C.VVENTA VALOR_ME,'' DISPLAY_NAME,'' NOMBRE,'' address1,'' city,'' country,'' phone_no
FROM ps_consumos C
LEFT JOIN ps_cuentas Q ON c.FECHA = Q.FECHA AND C.CODCAJA = Q.CODCAJA AND C.CUENTA = Q.CUENTA
LEFT JOIN Ps_producto P ON C.CODPRODUCTO = P.CODPRODUCTO
LEFT JOIN  Ps_Agrupa A ON A.CODAGRUPA = P.CODAGRUPA
WHERE C.fecha = @Fecha2 AND CODFPGO = 'TDM'
UNION
--CREDITO AMERICAN EXPRESS POS
SELECT '9107'  COD,39 CIA,C.FECHA,C.CUENTA RESERV,1 TIP,'333333333' TERCERO,'001' SUC,'' NAC,CONVERT(int,C.VVENTA*-1) VALOR,9999 HAB,C.TIQUETE RECIBO,
C.CONSUID TRX_NO,C.tiquete FACTURA,P.descripcion REFERENCIA,A.TIPOPROD NOTAS,'' NRO_TARJETA,'' AUTORIZACION,NULL FECHA_DE_VENC,
'' FACT_ASOC,'POS' TIPO_DOC,C.VVENTA VALOR_ME,'' DISPLAY_NAME,'' NOMBRE,'' address1,'' city,'' country,'' phone_no
FROM ps_consumos C
LEFT JOIN ps_cuentas Q ON c.FECHA = Q.FECHA AND C.CODCAJA = Q.CODCAJA AND C.CUENTA = Q.CUENTA
LEFT JOIN Ps_producto P ON C.CODPRODUCTO = P.CODPRODUCTO
LEFT JOIN  Ps_Agrupa A ON A.CODAGRUPA = P.CODAGRUPA
WHERE C.fecha = @Fecha2 AND CODFPGO = 'TCA'
UNION
--DEBITO AMERICAN EXPRESS POS
SELECT '9107'  COD,39 CIA,C.FECHA,C.CUENTA RESERV,1 TIP,'333333333' TERCERO,'001' SUC,'' NAC,CONVERT(int,C.VVENTA*-1) VALOR,9999 HAB,C.TIQUETE RECIBO,
C.CONSUID TRX_NO,C.tiquete FACTURA,P.descripcion REFERENCIA,A.TIPOPROD NOTAS,'' NRO_TARJETA,'' AUTORIZACION,NULL FECHA_DE_VENC,
'' FACT_ASOC,'POS' TIPO_DOC,C.VVENTA VALOR_ME,'' DISPLAY_NAME,'' NOMBRE,'' address1,'' city,'' country,'' phone_no
FROM ps_consumos C
LEFT JOIN ps_cuentas Q ON c.FECHA = Q.FECHA AND C.CODCAJA = Q.CODCAJA AND C.CUENTA = Q.CUENTA
LEFT JOIN Ps_producto P ON C.CODPRODUCTO = P.CODPRODUCTO
LEFT JOIN  Ps_Agrupa A ON A.CODAGRUPA = P.CODAGRUPA
WHERE C.fecha = @Fecha2 AND CODFPGO = 'TDA'
UNION
--CREDITO DINERS POS
SELECT '9110'  COD,39 CIA,C.FECHA,C.CUENTA RESERV,1 TIP,'333333333' TERCERO,'001' SUC,'' NAC,CONVERT(int,C.VVENTA*-1) VALOR,9999 HAB,C.TIQUETE RECIBO,
C.CONSUID TRX_NO,C.tiquete FACTURA,P.descripcion REFERENCIA,A.TIPOPROD NOTAS,'' NRO_TARJETA,'' AUTORIZACION,NULL FECHA_DE_VENC,
'' FACT_ASOC,'POS' TIPO_DOC,C.VVENTA VALOR_ME,'' DISPLAY_NAME,'' NOMBRE,'' address1,'' city,'' country,'' phone_no
FROM ps_consumos C
LEFT JOIN ps_cuentas Q ON c.FECHA = Q.FECHA AND C.CODCAJA = Q.CODCAJA AND C.CUENTA = Q.CUENTA
LEFT JOIN Ps_producto P ON C.CODPRODUCTO = P.CODPRODUCTO
LEFT JOIN  Ps_Agrupa A ON A.CODAGRUPA = P.CODAGRUPA
WHERE C.fecha = @Fecha2 AND CODFPGO = 'TCD'
UNION
--DEBITO DINERS POS
SELECT '9110'  COD,39 CIA,C.FECHA,C.CUENTA RESERV,1 TIP,'333333333' TERCERO,'001' SUC,'' NAC,CONVERT(int,C.VVENTA*-1) VALOR,9999 HAB,C.TIQUETE RECIBO,
C.CONSUID TRX_NO,C.tiquete FACTURA,P.descripcion REFERENCIA,A.TIPOPROD NOTAS,'' NRO_TARJETA,'' AUTORIZACION,NULL FECHA_DE_VENC,
'' FACT_ASOC,'POS' TIPO_DOC,C.VVENTA VALOR_ME,'' DISPLAY_NAME,'' NOMBRE,'' address1,'' city,'' country,'' phone_no
FROM ps_consumos C
LEFT JOIN ps_cuentas Q ON c.FECHA = Q.FECHA AND C.CODCAJA = Q.CODCAJA AND C.CUENTA = Q.CUENTA
LEFT JOIN Ps_producto P ON C.CODPRODUCTO = P.CODPRODUCTO
LEFT JOIN  Ps_Agrupa A ON A.CODAGRUPA = P.CODAGRUPA
WHERE C.fecha = @Fecha2 AND CODFPGO = 'TDN'
UNION
--POS MASTERCARD FRONT
select  M.CCARGO_CAR COD , 39 CIA,M.FECHA,  M.nfolio RESERV, 1 TIP, M.IDENT_CLI TERCERO, '001' SUC,
'' NAC, CONVERT(INT,valor) VALOR,'9999' HAB,CONVERT(VARCHAR(10), recibocaj) RECIBO, 
nroregis TRX_NO, 12344 FACTURA, M.MOTIVO REFERENCIA, M.MOTIVO NOTAS,M.tcre NRO_TARJETA, M.autor AUTORIZACION,
M.vcto FECHA_DE_VENC,'' FACT_ASOC,'' TIPO_DOC,  ( CASE WHEN dbcr = 'D' THEN 1 ELSE -1 END * valor ) VALORME,
(SELECT Max(nombre_cli) FROM Clientes C WHERE  C.IDENT_CLI = M.IDENT_CLI) DISPLAY_NAME, '' NOMBRE,
 (SELECT Max(direcc_cli) FROM Clientes C WHERE  C.ident_cli = M.ident_cli) address1,
 (SELECT Max(codciud)FROM Clientes C WHERE  C.ident_cli = M.ident_cli) city,
 (SELECT Max(codpais)FROM Clientes C WHERE  C.ident_cli = M.ident_cli) country,
 (SELECT Max(telef_cli)FROM Clientes C WHERE  C.ident_cli = M.ident_cli) phone_no 
 FROM movfolio M WHERE fecha =@Fecha1 AND FPAGO = 'T' AND PLAZA = 'MTC' AND dbcr = 'D'
 UNION
 --POS DINNERS FRONT
select  M.CCARGO_CAR COD , 39 CIA,M.FECHA,  M.nfolio RESERV, 1 TIP, M.IDENT_CLI TERCERO, '001' SUC,
'' NAC, CONVERT(INT,valor) VALOR,'9999' HAB,CONVERT(VARCHAR(10), recibocaj) RECIBO, 
nroregis TRX_NO, 12344 FACTURA, M.MOTIVO REFERENCIA, M.MOTIVO NOTAS,M.tcre NRO_TARJETA, M.autor AUTORIZACION,
M.vcto FECHA_DE_VENC,'' FACT_ASOC,'' TIPO_DOC,  ( CASE WHEN dbcr = 'D' THEN 1 ELSE -1 END * valor ) VALORME,
(SELECT Max(nombre_cli) FROM Clientes C WHERE  C.IDENT_CLI = M.IDENT_CLI) DISPLAY_NAME, '' NOMBRE,
 (SELECT Max(direcc_cli) FROM Clientes C WHERE  C.ident_cli = M.ident_cli) address1,
 (SELECT Max(codciud)FROM Clientes C WHERE  C.ident_cli = M.ident_cli) city,
 (SELECT Max(codpais)FROM Clientes C WHERE  C.ident_cli = M.ident_cli) country,
 (SELECT Max(telef_cli)FROM Clientes C WHERE  C.ident_cli = M.ident_cli) phone_no 
 FROM movfolio M WHERE fecha =@Fecha1 AND FPAGO = 'T' AND PLAZA = 'DIN' AND dbcr = 'D'
 UNION
 --POS AMERICAN EXPRESS FRONT
select  M.CCARGO_CAR COD , 39 CIA,M.FECHA,  M.nfolio RESERV, 1 TIP, M.IDENT_CLI TERCERO, '001' SUC,
'' NAC, CONVERT(INT,valor) VALOR,'9999' HAB,CONVERT(VARCHAR(10), recibocaj) RECIBO, 
nroregis TRX_NO, 12344 FACTURA, M.MOTIVO REFERENCIA, M.MOTIVO NOTAS,M.tcre NRO_TARJETA, M.autor AUTORIZACION,
M.vcto FECHA_DE_VENC,'' FACT_ASOC,'' TIPO_DOC,  ( CASE WHEN dbcr = 'D' THEN 1 ELSE -1 END * valor ) VALORME,
(SELECT Max(nombre_cli) FROM Clientes C WHERE  C.IDENT_CLI = M.IDENT_CLI) DISPLAY_NAME, '' NOMBRE,
 (SELECT Max(direcc_cli) FROM Clientes C WHERE  C.ident_cli = M.ident_cli) address1,
 (SELECT Max(codciud)FROM Clientes C WHERE  C.ident_cli = M.ident_cli) city,
 (SELECT Max(codpais)FROM Clientes C WHERE  C.ident_cli = M.ident_cli) country,
 (SELECT Max(telef_cli)FROM Clientes C WHERE  C.ident_cli = M.ident_cli) phone_no 
 FROM movfolio M WHERE fecha =@Fecha1 AND FPAGO = 'T' AND PLAZA = 'AMX' AND dbcr = 'D'
 UNION
 -- CREDITO VISA POS
SELECT '9106'  COD,39 CIA,C.FECHA,C.CUENTA RESERV,1 TIP,'333333333' TERCERO,'001' SUC,'' NAC,CONVERT(int,C.VVENTA*-1) VALOR,9999 HAB,C.TIQUETE RECIBO,
C.CONSUID TRX_NO,C.tiquete FACTURA,P.descripcion REFERENCIA,A.TIPOPROD NOTAS,'' NRO_TARJETA,'' AUTORIZACION,NULL FECHA_DE_VENC,'' FACT_ASOC,'POS' TIPO_DOC,
C.VVENTA VALOR_ME,'' DISPLAY_NAME,'' NOMBRE,'' address1,'' city,'' country,'' phone_no
FROM ps_consumos C
LEFT JOIN ps_cuentas Q ON c.FECHA = Q.FECHA AND C.CODCAJA = Q.CODCAJA AND C.CUENTA = Q.CUENTA
LEFT JOIN Ps_producto P ON C.CODPRODUCTO = P.CODPRODUCTO
LEFT JOIN  Ps_Agrupa A ON A.CODAGRUPA = P.CODAGRUPA
WHERE C.fecha = @Fecha2 AND CODFPGO = 'TCV'
UNION
--ALOJAMIENTO EXCENTO 5012
select  5012 COD , 39 CIA,M.FECHA,  M.nfolio RESERV, 1 TIP, M.IDENT_CLI TERCERO, '001' SUC,
'' NAC, CONVERT(INT,valor)  VALOR,'9999' HAB,CONVERT(VARCHAR(10), recibocaj) RECIBO, 
nroregis TRX_NO, 12344 FACTURA, M.MOTIVO REFERENCIA, M.MOTIVO NOTAS,M.tcre NRO_TARJETA, M.autor AUTORIZACION,
M.vcto FECHA_DE_VENC,'' FACT_ASOC,'' TIPO_DOC,  ( CASE WHEN dbcr = 'D' THEN 1 ELSE -1 END * valor ) VALORME,
(SELECT Max(nombre_cli) FROM Clientes C WHERE  C.IDENT_CLI = M.IDENT_CLI) DISPLAY_NAME, '' NOMBRE,
 (SELECT Max(direcc_cli) FROM Clientes C WHERE  C.ident_cli = M.ident_cli) address1,
 (SELECT Max(codciud)FROM Clientes C WHERE  C.ident_cli = M.ident_cli) city,
 (SELECT Max(codpais)FROM Clientes C WHERE  C.ident_cli = M.ident_cli) country,
 (SELECT Max(telef_cli)FROM Clientes C WHERE  C.ident_cli = M.ident_cli) phone_no 
 FROM movfolio M WHERE fecha =@Fecha1 AND ccargo_car = 5012

