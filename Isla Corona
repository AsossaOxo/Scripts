
DECLARE @Fecha1 DATE = '2025-08-16';
DECLARE @Fecha2 DATE = '20250816';

SELECT 1002 COD,'Isla' CIA,fecha,M.nfolio RESERV, 1 TIP,A.ident_cli TERCERO,'001' SUC,'' NAC,
CONVERT(int,(CASE WHEN dbcr = 'D' THEN 1 ELSE -1 END * valor )) VALOR,
CASE WHEN ISNUMERIC(M.nrohab_hab) = 1 THEN CONVERT(varchar(10), M.nrohab_hab) ELSE '9999' END HAB,
CASE  WHEN ISNUMERIC(recibocaj) = 1 THEN CONVERT(VARCHAR(10), recibocaj)ELSE NULL END RECIBO,
nroregis TRX_NO,factura FACTURA,descri_car REFERENCIA,motivo NOTAS,M.tcre NRO_TARJETA,M.autor AUTORIZACION,
M.vcto FECHA_DE_VENC,'' FACT_ASOC,'' TIPO_DOC,tasachin_us VALOR_ME,(SELECT Max(nombre_cli) 
FROM clientes C WHERE  C.ident_cli = A.ident_cli) DISPLAY_NAME,'' NOMBRE,
(SELECT Max(direcc_cli) FROM Clientes C WHERE  C.ident_cli = A.ident_cli) address1,
(SELECT Max(codciud) FROM Clientes C WHERE  C.ident_cli = A.ident_cli) city,
(SELECT Max(codpais) FROM Clientes C WHERE  C.ident_cli = A.ident_cli) country,
(SELECT Max(telef_cli) FROM Clientes C WHERE  C.ident_cli = A.ident_cli) phone_no
FROM Movfolio M,Cargos C,Maefolio A
WHERE M.ccargo_car = C.ccargo_car AND M.nfolio = A.nfolio AND fecha = @Fecha1 AND  M.ccargo_car = 1002 
AND ( m.plaza = '0' OR m.plaza IS NULL)

UNION 

SELECT 1003 COD,'Isla' CIA,fecha,M.nfolio RESERV, 1 TIP,A.ident_cli TERCERO,'001' SUC,'' NAC,
CONVERT(int,(CASE WHEN dbcr = 'D' THEN 1 ELSE -1 END * valor )) VALOR,
CASE WHEN ISNUMERIC(M.nrohab_hab) = 1 THEN CONVERT(varchar(10), M.nrohab_hab) ELSE '9999' END HAB,
CASE  WHEN ISNUMERIC(recibocaj) = 1 THEN CONVERT(VARCHAR(10), recibocaj)ELSE NULL END RECIBO,
nroregis TRX_NO,factura FACTURA,descri_car REFERENCIA,DBCR NOTAS,M.tcre NRO_TARJETA,M.autor AUTORIZACION,
M.vcto FECHA_DE_VENC,'' FACT_ASOC,'' TIPO_DOC,tasachin_us VALOR_ME,(SELECT Max(nombre_cli) 
FROM clientes C WHERE  C.ident_cli = A.ident_cli) DISPLAY_NAME,'' NOMBRE,
(SELECT Max(direcc_cli) FROM Clientes C WHERE  C.ident_cli = A.ident_cli) address1,
(SELECT Max(codciud) FROM Clientes C WHERE  C.ident_cli = A.ident_cli) city,
(SELECT Max(codpais) FROM Clientes C WHERE  C.ident_cli = A.ident_cli) country,
(SELECT Max(telef_cli) FROM Clientes C WHERE  C.ident_cli = A.ident_cli) phone_no
FROM Movfolio M,Cargos C,Maefolio A
WHERE M.ccargo_car = C.ccargo_car AND M.nfolio = A.nfolio AND fecha = @Fecha1 AND  M.ccargo_car = 1003 
AND ( m.plaza = '0' OR m.plaza IS NULL)

UNION  

SELECT 1001 COD,'Isla' CIA,fecha,M.nfolio RESERV, 1 TIP,A.ident_cli TERCERO,'001' SUC,'' NAC,
CONVERT(int,(CASE WHEN dbcr = 'D' THEN 1 ELSE -1 END * valor )) VALOR,
CASE WHEN ISNUMERIC(M.nrohab_hab) = 1 THEN CONVERT(varchar(10), M.nrohab_hab) ELSE '9999' END HAB,
CASE  WHEN ISNUMERIC(recibocaj) = 1 THEN CONVERT(VARCHAR(10), recibocaj)ELSE NULL END RECIBO,
nroregis TRX_NO,factura FACTURA,descri_car REFERENCIA,DBCR NOTAS,M.tcre NRO_TARJETA,M.autor AUTORIZACION,
M.vcto FECHA_DE_VENC,'' FACT_ASOC,'' TIPO_DOC,tasachin_us VALOR_ME,(SELECT Max(nombre_cli) 
FROM clientes C WHERE  C.ident_cli = A.ident_cli) DISPLAY_NAME,'' NOMBRE,
(SELECT Max(direcc_cli) FROM Clientes C WHERE  C.ident_cli = A.ident_cli) address1,
(SELECT Max(codciud) FROM Clientes C WHERE  C.ident_cli = A.ident_cli) city,
(SELECT Max(codpais) FROM Clientes C WHERE  C.ident_cli = A.ident_cli) country,
(SELECT Max(telef_cli) FROM Clientes C WHERE  C.ident_cli = A.ident_cli) phone_no
FROM Movfolio M,Cargos C,Maefolio A
WHERE M.ccargo_car = C.ccargo_car AND M.nfolio = A.nfolio AND fecha = @Fecha1 AND  M.ccargo_car = 1001 AND DBCR = 'D'

/** RESTAURANTE PASADIA  **/

select  1001 COD,39 CIA, C.FECHA,C.cuenta RESERV,1 TIP,'333333333' TRECERO,'001' SUC,'' NAC,C.VVENTA VALOR,
9999 HAB,CONVERT(VARCHAR(10), tiquete)  RECIBO,consuid TRX_NO,tiquete FACTURA,'PROPINA POS' REFERENCIA, P.CODCENTRO NOTAS,'' NRO_TARJETA,'' AUTORIZACION,NULL FECHA_DE_VENC,'' FACT_ASOC,'PASADIA' TIPO_DOC,CONVERT(int,C.VVENTA)  VALOR_ME,
'' DISPLAY_NAME,'' NOMBRE,'' address1,'' city,''country,'' phone_no
  FROM ps_consumos C
INNER JOIN ps_cuentas Q ON c.FECHA = Q.FECHA AND C.CODCAJA = Q.CODCAJA AND C.CUENTA = Q.CUENTA
INNER JOIN Ps_producto P ON C.CODPRODUCTO = P.CODPRODUCTO
INNER JOIN Ps_Agrupa A ON A.CODAGRUPA = P.CODAGRUPA
WHERE C.fecha = @Fecha2 AND C.TRANSFERID IS NULL AND C.VVENTA > 0  AND C.CODCAJA = 'PD'


UNION

select  1001 COD,39 CIA, PS.FECHA,PS.cuenta RESERV,1 TIP,'333333333' TRECERO,'001' SUC,'' NAC,CONVERT(int,PS.DESCUENTO)/2 * -1 VALOR,
9999 HAB,CONVERT(VARCHAR(10), NFOLIO)  RECIBO,CUENTA TRX_NO,CUENTA FACTURA,'DESC PASADIA ALIMENTOS' REFERENCIA, 'A' NOTAS,'' NRO_TARJETA,'' AUTORIZACION,NULL FECHA_DE_VENC,'' FACT_ASOC,'PASADIA' TIPO_DOC,CONVERT(int,PS.DESCUENTO)/2 * -1  VALOR_ME,
'' DISPLAY_NAME,'' NOMBRE,'' address1,'' city,''country,'' phone_no
  FROM ps_cuentas  PS
WHERE PS.fecha = @Fecha2 AND PS.DESCUENTO <> '0'


UNION 
 
select  1001 COD,39 CIA, PS.FECHA,PS.cuenta RESERV,1 TIP,'333333333' TRECERO,'001' SUC,'' NAC,CONVERT(int,PS.DESCUENTO)/2 * -1 VALOR,
9999 HAB,CONVERT(VARCHAR(10), NFOLIO)  RECIBO,CUENTA TRX_NO,CUENTA FACTURA,'DESC PASADIA BEBIDAS' REFERENCIA, 'B' NOTAS,'' NRO_TARJETA,'' AUTORIZACION,NULL FECHA_DE_VENC,'' FACT_ASOC,'PASADIA' TIPO_DOC,CONVERT(int,PS.DESCUENTO)/2 * -1  VALOR_ME,
'' DISPLAY_NAME,'' NOMBRE,'' address1,'' city,''country,'' phone_no
  FROM ps_cuentas  PS
WHERE PS.fecha = @Fecha2 AND PS.DESCUENTO <> '0'



/** ALIMENTOS Y BEBDIDAS **/
/** ESTA ES LA CONSULTA PARA RESTAURANTE  **/

select  5001 COD,39 CIA, C.FECHA,C.cuenta RESERV,1 TIP,'333333333' TRECERO,'001' SUC,'' NAC,C.VVENTA VALOR,
9999 HAB,CONVERT(VARCHAR(10), tiquete)  RECIBO,consuid TRX_NO,tiquete FACTURA,'REST' REFERENCIA, P.CODCENTRO NOTAS,'' NRO_TARJETA,'' AUTORIZACION,NULL FECHA_DE_VENC,'' FACT_ASOC,'REST' TIPO_DOC,CONVERT(int,C.VVENTA)  VALOR_ME,
'' DISPLAY_NAME,'' NOMBRE,'' address1,'' city,''country,'' phone_no
  FROM ps_consumos C
INNER JOIN ps_cuentas Q ON c.FECHA = Q.FECHA AND C.CODCAJA = Q.CODCAJA AND C.CUENTA = Q.CUENTA
INNER JOIN Ps_producto P ON C.CODPRODUCTO = P.CODPRODUCTO
INNER JOIN Ps_Agrupa A ON A.CODAGRUPA = P.CODAGRUPA
WHERE C.fecha = @Fecha2 AND C.TRANSFERID IS NULL AND C.VVENTA <> 0 
AND  C.CODCAJA = 'REST' AND C.PLAZA <>'ATE'

/** ESTA ES LA CONSULTA PARA PL CHIRINGUITO   **/

DECLARE @Fecha2 DATE = '20250817';
select  5002 COD,39 CIA, C.FECHA,C.cuenta RESERV,1 TIP,'333333333' TRECERO,'001' SUC,'' NAC,C.VVENTA VALOR,
9999 HAB,CONVERT(VARCHAR(10), tiquete)  RECIBO,consuid TRX_NO,tiquete FACTURA,'REST' REFERENCIA, P.CODCENTRO NOTAS,'' NRO_TARJETA,'' AUTORIZACION,NULL FECHA_DE_VENC,'' FACT_ASOC,'REST' TIPO_DOC,CONVERT(int,C.VVENTA)  VALOR_ME,
'' DISPLAY_NAME,'' NOMBRE,'' address1,'' city,''country,'' phone_no
  FROM ps_consumos C
INNER JOIN ps_cuentas Q ON c.FECHA = Q.FECHA AND C.CODCAJA = Q.CODCAJA AND C.CUENTA = Q.CUENTA
INNER JOIN Ps_producto P ON C.CODPRODUCTO = P.CODPRODUCTO
INNER JOIN Ps_Agrupa A ON A.CODAGRUPA = P.CODAGRUPA
WHERE C.fecha = @Fecha2 AND C.TRANSFERID IS NULL AND C.VVENTA <> 0 
 AND  C.CODCAJA = 'PL'  AND C.PLAZA <>'ATE'



 /** ESTA ES LA CONSULTA PARA PL PARCHADERO  SC   **/

select  5002 COD,39 CIA, C.FECHA,C.cuenta RESERV,1 TIP,'333333333' TRECERO,'001' SUC,'' NAC,C.VVENTA VALOR,
9999 HAB,CONVERT(VARCHAR(10), tiquete)  RECIBO,consuid TRX_NO,tiquete FACTURA,'REST' REFERENCIA, P.CODCENTRO NOTAS,'' NRO_TARJETA,'' AUTORIZACION,NULL FECHA_DE_VENC,'' FACT_ASOC,'REST' TIPO_DOC,CONVERT(int,C.VVENTA)  VALOR_ME,
'' DISPLAY_NAME,'' NOMBRE,'' address1,'' city,''country,'' phone_no
  FROM ps_consumos C
INNER JOIN ps_cuentas Q ON c.FECHA = Q.FECHA AND C.CODCAJA = Q.CODCAJA AND C.CUENTA = Q.CUENTA
INNER JOIN Ps_producto P ON C.CODPRODUCTO = P.CODPRODUCTO
INNER JOIN Ps_Agrupa A ON A.CODAGRUPA = P.CODAGRUPA
WHERE C.fecha = @Fecha2 AND C.TRANSFERID IS NULL AND C.VVENTA <> 0 
 AND  C.CODCAJA = 'SC'  AND C.PLAZA <>'ATE'






